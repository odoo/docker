<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_invoice_document" inherit_id="account.report_invoice_document" primary="True">
        <!-- Custom name -->
        <xpath expr="//t[@t-set='layout_document_title']" position="replace">
            <t t-set="layout_document_title">
                <span t-if="not proforma"></span>
                <span t-else="">PROFORMA</span>
                <span t-field="o.l10n_co_edi_type">Factura de venta</span>
                <span t-if="o.name != '/'" t-field="o.name">INV/2023/0001</span>
            </t>
        </xpath>

        <!-- Payment Means & Payment Method -->
        <xpath expr="//div[@id='informations']/div[@name='due_date']" position="after">
            <div name="payment_means"
                 class="col"
                 t-if="o.l10n_co_edi_payment_option_id">
                <strong>Payment Means</strong>
                <div t-field="o.l10n_co_edi_payment_option_id.name">Crédito ACH</div>
            </div>
            <div name="payment_method"
                 class="col"
                 t-if="o.l10n_co_edi_payment_option_id.code in ('1', '2')">
                <strong>Payment Method</strong>
                <div t-if="o.l10n_co_edi_is_direct_payment">Contado</div>
                <div t-else="">Crédito</div>
            </div>
        </xpath>

        <!-- QR CODE section -->
        <div id='payment_term' position="after">
            <t t-set="dian_values" t-value="o._l10n_co_dian_get_extra_invoice_report_values()"/>
            <div id="complement" style="font-size:14px;">
                <div class="row">
                    <div class="col-4">
                        <img alt="Barcode" t-att-src="dian_values.get('barcode_src')"/>
                    </div>
                    <div class="col-8">
                        <div style="margin:5px;">
                            <ul style="list-style: none">
                                <li>DIAN resolution <span t-out="o.journal_id.l10n_co_edi_dian_authorization_number">18760000001</span></li>
                                <li>Effective date from <span t-out="o.journal_id.l10n_co_edi_dian_authorization_date">2019-01-01</span> to
                                    <span t-out="o.journal_id.l10n_co_edi_dian_authorization_end_date">2030-12-31</span></li>
                                <li>Sequence number from <span t-out="o.journal_id.code + str(o.journal_id.l10n_co_edi_min_range_number)">SETT1</span> to
                                    <span t-out="o.journal_id.code + str(o.journal_id.l10n_co_edi_max_range_number)">SETT5000000</span></li>
                                <li><span t-if="not o.company_id.partner_id.l10n_co_edi_large_taxpayer" t-out="'No '"/>Somos Grandes Contribuyentes</li>
                                <li>Tax regime: <span t-out="', '.join(o.company_id.partner_id.l10n_co_edi_obligation_type_ids.mapped('description'))">Autorretenedor</span></li>
                                <li>Tax responsability: <span t-out="o.company_id.partner_id._l10n_co_edi_get_fiscal_regimen_name()">IVA</span></li>
                                <li>Economic activity: <span t-out="o.company_id.l10n_co_edi_header_actividad_economica">4390</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top: 5px">
                    <div class="col">
                        <ul style="list-style: none; padding-left: 0">
                            <li style="font-weight: bold;">
                                <span t-out="o.l10n_co_dian_identifier_type.upper()">CUFE</span>: <span t-out="dian_values.get('identifier')">6c33aba6cd0086c0af774f5ff5e3535e16dc9a753df6bdd8da3d5d242ccee7016d4fc897225593b6e240a9e9f8b19373</span>
                            </li>
                            <li>Signing date: <span t-out="dian_values.get('signing_datetime')">2024-03-15 15:43:58</span></li>
                            <li>Issuing date: <span t-out="o.l10n_co_dian_post_time">2024-03-15 15:43:50</span></li>
                            <li>Generated by: Software Propio</li>
                            <li>NIT: <span t-out="o.company_id.vat">1018418009</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Workaround for Studio reports, see odoo/odoo#60660 -->
    <template id="report_invoice" inherit_id="account.report_invoice">
        <xpath expr='//t[@t-call="account.report_invoice_document"]' position="after">
            <t t-elif="o._get_name_invoice_report() == 'l10n_co_dian.report_invoice_document'"
               t-call="l10n_co_dian.report_invoice_document"
               t-lang="lang"/>
        </xpath>
    </template>
</odoo>
